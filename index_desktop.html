<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rental Property Investment Calculator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .section {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background-color: #fafafa;
        }

        .section h2 {
            color: #34495e;
            margin-top: 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
            align-items: center;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .two-col {
            grid-column: span 2;
        }

        label {
            font-weight: 600;
            color: #2c3e50;
        }

        input[type="number"], input[type="text"], select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input[type="number"]:focus, input[type="text"]:focus, select:focus {
            border-color: #3498db;
            outline: none;
        }

        .calculated {
            background-color: #ecf0f1;
            font-weight: bold;
            color: #2c3e50;
            border: 2px solid #bdc3c7;
        }

        .positive {
            color: #27ae60;
            background-color: #d5f4e6;
        }

        .negative {
            color: #e74c3c;
            background-color: #fadbd8;
        }

        .neutral {
            color: #f39c12;
            background-color: #fdeaa7;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .metric-label {
            color: #7f8c8d;
            font-size: 14px;
        }

        .decision-box {
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        .excellent { background-color: #d5f4e6; color: #27ae60; border: 2px solid #27ae60; }
        .good { background-color: #dff0d8; color: #3c763d; border: 2px solid #3c763d; }
        .fair { background-color: #fdeaa7; color: #856404; border: 2px solid #856404; }
        .poor { background-color: #fadbd8; color: #a94442; border: 2px solid #a94442; }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .summary-table th, .summary-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .summary-table th {
            background-color: #3498db;
            color: white;
        }

        .summary-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .export-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }

        .export-btn:hover {
            transform: translateY(-2px);
        }

        .pdf-btn { background: #e74c3c; color: white; }
        .json-btn { background: #3498db; color: white; }
        .print-btn { background: #95a5a6; color: white; }
        .save-btn { background: #f39c12; color: white; }

        .saved-analysis {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .saved-analysis h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }

        .saved-analysis-meta {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .saved-analysis-actions {
            display: flex;
            gap: 10px;
        }

        .load-btn {
            background: #27ae60;
            color: white;
            padding: 5px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            padding: 5px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        @media print {
            .no-print { display: none !important; }
            .container { box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè† Rental Property Investment Calculator</h1>

        <div style="text-align: center; margin-bottom: 30px; padding: 15px; background: #f8f9fa; border-radius: 8px;" class="no-print">
            <a href="area-investment-predictor.html" style="background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%); color: white; padding: 12px 25px; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 16px;">üìà Area Investment Predictor</a>
            <p style="margin: 10px 0 0 0; color: #666; font-size: 14px;">Analyze market momentum and predict investment opportunities</p>
        </div>

        <!-- Property Information -->
        <div class="section">
            <h2>Property Information</h2>
            <div class="row">
                <div>
                    <label>Address:</label>
                    <input type="text" id="address" placeholder="123 Main St, City, State">
                </div>
                <div>
                    <label>Property Type:</label>
                    <select id="propertyType">
                        <option value="single">Single Family</option>
                        <option value="duplex">Duplex</option>
                        <option value="condo">Condo</option>
                        <option value="townhouse">Townhouse</option>
                        <option value="multifamily">Multi-Family</option>
                    </select>
                </div>
                <div>
                    <label>Year Built:</label>
                    <input type="number" id="yearBuilt" placeholder="1990">
                </div>
            </div>
            <div class="row">
                <div>
                    <label>Square Footage:</label>
                    <input type="number" id="sqft" placeholder="1500">
                </div>
                <div>
                    <label>Bedrooms:</label>
                    <input type="number" id="bedrooms" placeholder="3">
                </div>
                <div>
                    <label>Bathrooms:</label>
                    <input type="number" id="bathrooms" step="0.5" placeholder="2">
                </div>
            </div>
        </div>

        <!-- Purchase Details -->
        <div class="section">
            <h2>Purchase & Financing</h2>
            <div class="row">
                <div>
                    <label>Purchase Price ($):</label>
                    <input type="number" id="purchasePrice" placeholder="200000" oninput="calculateAll()">
                </div>
                <div>
                    <label>Down Payment (%):</label>
                    <input type="number" id="downPaymentPercent" placeholder="20" oninput="calculateAll()">
                </div>
                <div>
                    <label>Down Payment ($):</label>
                    <input type="number" id="downPaymentAmount" class="calculated" readonly>
                </div>
            </div>
            <div class="row">
                <div>
                    <label>Interest Rate (%):</label>
                    <input type="number" id="interestRate" step="0.01" placeholder="6.5" oninput="calculateAll()">
                </div>
                <div>
                    <label>Loan Term (years):</label>
                    <input type="number" id="loanTerm" placeholder="30" oninput="calculateAll()">
                </div>
                <div>
                    <label>Loan Amount ($):</label>
                    <input type="number" id="loanAmount" class="calculated" readonly>
                </div>
            </div>
            <div class="row">
                <div>
                    <label>Closing Costs ($):</label>
                    <input type="number" id="closingCosts" placeholder="5000" oninput="calculateAll()">
                </div>
                <div>
                    <label>Initial Repairs ($):</label>
                    <input type="number" id="initialRepairs" placeholder="3000" oninput="calculateAll()">
                </div>
                <div>
                    <label>Total Initial Investment ($):</label>
                    <input type="number" id="totalInvestment" class="calculated" readonly>
                </div>
            </div>
        </div>

        <!-- Monthly Income -->
        <div class="section">
            <h2>üí∞ Monthly Income</h2>
            <div class="row">
                <div>
                    <label>Monthly Rent ($):</label>
                    <input type="number" id="monthlyRent" placeholder="1800" oninput="calculateAll()">
                </div>
                <div>
                    <label>Other Income ($):</label>
                    <input type="number" id="otherIncome" placeholder="0" oninput="calculateAll()">
                </div>
                <div>
                    <label>Total Monthly Income ($):</label>
                    <input type="number" id="totalIncome" class="calculated" readonly>
                </div>
            </div>
        </div>

        <!-- Monthly Expenses -->
        <div class="section">
            <h2>üí∏ Monthly Expenses</h2>
            <div class="row">
                <div>
                    <label>Mortgage Payment ($):</label>
                    <input type="number" id="mortgagePayment" class="calculated" readonly>
                </div>
                <div>
                    <label>Property Taxes ($/month):</label>
                    <input type="number" id="propertyTaxes" placeholder="200" oninput="calculateAll()">
                </div>
                <div>
                    <label>Insurance ($/month):</label>
                    <input type="number" id="insurance" placeholder="100" oninput="calculateAll()">
                </div>
            </div>

            <div class="row">
                <div>
                    <label>HOA Fees ($/month):</label>
                    <input type="number" id="hoaFees" placeholder="0" oninput="calculateAll()">
                </div>
                <div>
                    <label>Property Management (%):</label>
                    <input type="number" id="mgmtPercent" placeholder="10" oninput="calculateAll()">
                </div>
                <div>
                    <label>Management Fee ($):</label>
                    <input type="number" id="mgmtFee" class="calculated" readonly>
                </div>
            </div>

            <div class="row">
                <div>
                    <label>Maintenance Reserve (%):</label>
                    <input type="number" id="maintenancePercent" placeholder="8" oninput="calculateAll()">
                </div>
                <div>
                    <label>Maintenance ($):</label>
                    <input type="number" id="maintenance" class="calculated" readonly>
                </div>
                <div>
                    <label>Vacancy Reserve (%):</label>
                    <input type="number" id="vacancyPercent" placeholder="6" oninput="calculateAll()">
                </div>
            </div>

            <div class="row">
                <div>
                    <label>Vacancy Reserve ($):</label>
                    <input type="number" id="vacancy" class="calculated" readonly>
                </div>
                <div>
                    <label>Other Expenses ($):</label>
                    <input type="number" id="otherExpenses" placeholder="50" oninput="calculateAll()">
                </div>
                <div>
                    <label>Total Monthly Expenses ($):</label>
                    <input type="number" id="totalExpenses" class="calculated" readonly>
                </div>
            </div>
        </div>

        <!-- Cash Flow Summary -->
        <div class="section">
            <h2>üìä Cash Flow Summary</h2>
            <div class="row">
                <div class="full-width">
                    <label>Net Monthly Cash Flow ($):</label>
                    <input type="number" id="cashFlow" class="calculated" readonly>
                </div>
            </div>
        </div>

        <!-- Investment Metrics -->
        <div class="section">
            <h2>Key Investment Metrics</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">1% Rule Check</div>
                    <div class="metric-value" id="onePercentRule">0.0%</div>
                    <div id="onePercentStatus">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Cap Rate</div>
                    <div class="metric-value" id="capRate">0.0%</div>
                    <div>Annual NOI √∑ Purchase Price</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Cash-on-Cash Return</div>
                    <div class="metric-value" id="cashOnCash">0.0%</div>
                    <div>Annual Cash Flow √∑ Investment</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Debt Service Coverage</div>
                    <div class="metric-value" id="dscr">0.00</div>
                    <div>Income √∑ Mortgage Payment</div>
                </div>
            </div>
        </div>

        <!-- Annual Summary -->
        <div class="section">
            <h2>Annual Summary</h2>
            <table class="summary-table">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Monthly</th>
                        <th>Annual</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Gross Rental Income</td>
                        <td id="monthlyGrossIncome">$0</td>
                        <td id="annualGrossIncome">$0</td>
                    </tr>
                    <tr>
                        <td>Total Expenses</td>
                        <td id="monthlyTotalExpenses">$0</td>
                        <td id="annualTotalExpenses">$0</td>
                    </tr>
                    <tr>
                        <td>Net Operating Income (NOI)</td>
                        <td id="monthlyNOI">$0</td>
                        <td id="annualNOI">$0</td>
                    </tr>
                    <tr>
                        <td>Mortgage Payments</td>
                        <td id="monthlyMortgage">$0</td>
                        <td id="annualMortgage">$0</td>
                    </tr>
                    <tr style="font-weight: bold; background-color: #e8f4fd;">
                        <td>Net Cash Flow</td>
                        <td id="monthlyCashFlow">$0</td>
                        <td id="annualCashFlow">$0</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Investment Decision -->
        <div class="section">
            <h2>Investment Decision</h2>
            <div id="decisionBox" class="decision-box">
                Enter property details to see recommendation
            </div>
        </div>

        <!-- Save/Export Options -->
        <div class="section no-print" id="exportSection" style="display: none;">
            <h2>üíæ Save & Export Analysis</h2>
            <div class="export-buttons">
                <button onclick="exportToPDF()" class="export-btn pdf-btn">üìÑ Save as PDF</button>
                <button onclick="exportToJSON()" class="export-btn json-btn">üíæ Export Data (JSON)</button>
                <button onclick="printAnalysis()" class="export-btn print-btn">üñ®Ô∏è Print Analysis</button>
                <button onclick="saveToLocalStorage()" class="export-btn save-btn">üíø Save Locally</button>
            </div>
        </div>

        <!-- Saved Analyses -->
        <div class="section no-print" id="savedAnalyses" style="display: none;">
            <h2>üìÇ Saved Analyses</h2>
            <div id="savedList"></div>
        </div>
    </div>

    <script>
        function calculateAll() {
            // Get input values
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const downPaymentPercent = parseFloat(document.getElementById('downPaymentPercent').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const loanTerm = parseFloat(document.getElementById('loanTerm').value) || 30;
            const closingCosts = parseFloat(document.getElementById('closingCosts').value) || 0;
            const initialRepairs = parseFloat(document.getElementById('initialRepairs').value) || 0;

            const monthlyRent = parseFloat(document.getElementById('monthlyRent').value) || 0;
            const otherIncome = parseFloat(document.getElementById('otherIncome').value) || 0;
            const propertyTaxes = parseFloat(document.getElementById('propertyTaxes').value) || 0;
            const insurance = parseFloat(document.getElementById('insurance').value) || 0;
            const hoaFees = parseFloat(document.getElementById('hoaFees').value) || 0;
            const mgmtPercent = parseFloat(document.getElementById('mgmtPercent').value) || 0;
            const maintenancePercent = parseFloat(document.getElementById('maintenancePercent').value) || 0;
            const vacancyPercent = parseFloat(document.getElementById('vacancyPercent').value) || 0;
            const otherExpenses = parseFloat(document.getElementById('otherExpenses').value) || 0;

            // Calculate loan details
            const downPaymentAmount = purchasePrice * (downPaymentPercent / 100);
            const loanAmount = purchasePrice - downPaymentAmount;
            const totalInvestment = downPaymentAmount + closingCosts + initialRepairs;

            // Calculate monthly mortgage payment
            const monthlyRate = (interestRate / 100) / 12;
            const numPayments = loanTerm * 12;
            let mortgagePayment = 0;

            if (monthlyRate > 0 && numPayments > 0) {
                mortgagePayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) /
                                (Math.pow(1 + monthlyRate, numPayments) - 1);
            }

            // Calculate income and expenses
            const totalIncome = monthlyRent + otherIncome;
            const mgmtFee = monthlyRent * (mgmtPercent / 100);
            const maintenance = monthlyRent * (maintenancePercent / 100);
            const vacancy = monthlyRent * (vacancyPercent / 100);

            const totalExpenses = mortgagePayment + propertyTaxes + insurance + hoaFees +
                                mgmtFee + maintenance + vacancy + otherExpenses;
            const cashFlow = totalIncome - totalExpenses;

            // Calculate NOI (excludes mortgage payment)
            const noi = totalIncome - (propertyTaxes + insurance + hoaFees + mgmtFee + maintenance + vacancy + otherExpenses);

            // Calculate metrics
            const onePercentRule = purchasePrice > 0 ? (monthlyRent / purchasePrice) * 100 : 0;
            const capRate = purchasePrice > 0 ? (noi * 12 / purchasePrice) * 100 : 0;
            const cashOnCash = totalInvestment > 0 ? (cashFlow * 12 / totalInvestment) * 100 : 0;
            const dscr = mortgagePayment > 0 ? totalIncome / mortgagePayment : 0;

            // Update calculated fields
            document.getElementById('downPaymentAmount').value = downPaymentAmount.toFixed(0);
            document.getElementById('loanAmount').value = loanAmount.toFixed(0);
            document.getElementById('totalInvestment').value = totalInvestment.toFixed(0);
            document.getElementById('mortgagePayment').value = mortgagePayment.toFixed(2);
            document.getElementById('totalIncome').value = totalIncome.toFixed(2);
            document.getElementById('mgmtFee').value = mgmtFee.toFixed(2);
            document.getElementById('maintenance').value = maintenance.toFixed(2);
            document.getElementById('vacancy').value = vacancy.toFixed(2);
            document.getElementById('totalExpenses').value = totalExpenses.toFixed(2);

            // Update cash flow with color coding
            const cashFlowField = document.getElementById('cashFlow');
            cashFlowField.value = cashFlow.toFixed(2);
            cashFlowField.className = 'calculated ' + (cashFlow > 0 ? 'positive' : cashFlow < 0 ? 'negative' : 'neutral');

            // Update metrics
            document.getElementById('onePercentRule').textContent = onePercentRule.toFixed(2) + '%';
            document.getElementById('onePercentStatus').textContent = onePercentRule >= 1.0 ? '‚úÖ Meets Rule' : '‚ùå Below Rule';

            document.getElementById('capRate').textContent = capRate.toFixed(2) + '%';
            document.getElementById('capRate').className = 'metric-value ' +
                (capRate >= 8 ? 'positive' : capRate >= 6 ? 'neutral' : 'negative');

            document.getElementById('cashOnCash').textContent = cashOnCash.toFixed(2) + '%';
            document.getElementById('cashOnCash').className = 'metric-value ' +
                (cashOnCash >= 8 ? 'positive' : cashOnCash >= 5 ? 'neutral' : 'negative');

            document.getElementById('dscr').textContent = dscr.toFixed(2);
            document.getElementById('dscr').className = 'metric-value ' +
                (dscr >= 1.25 ? 'positive' : dscr >= 1.0 ? 'neutral' : 'negative');

            // Update annual summary
            document.getElementById('monthlyGrossIncome').textContent = '$' + totalIncome.toFixed(0);
            document.getElementById('annualGrossIncome').textContent = '$' + (totalIncome * 12).toFixed(0);

            const operatingExpenses = totalExpenses - mortgagePayment;
            document.getElementById('monthlyTotalExpenses').textContent = '$' + operatingExpenses.toFixed(0);
            document.getElementById('annualTotalExpenses').textContent = '$' + (operatingExpenses * 12).toFixed(0);

            document.getElementById('monthlyNOI').textContent = '$' + noi.toFixed(0);
            document.getElementById('annualNOI').textContent = '$' + (noi * 12).toFixed(0);

            document.getElementById('monthlyMortgage').textContent = '$' + mortgagePayment.toFixed(0);
            document.getElementById('annualMortgage').textContent = '$' + (mortgagePayment * 12).toFixed(0);

            document.getElementById('monthlyCashFlow').textContent = '$' + cashFlow.toFixed(0);
            document.getElementById('annualCashFlow').textContent = '$' + (cashFlow * 12).toFixed(0);

            // Investment decision logic
            let score = 0;
            let recommendation = '';
            let className = '';

            // Scoring criteria
            if (cashFlow > 0) score += 30;
            if (onePercentRule >= 1.0) score += 20;
            if (capRate >= 8) score += 20;
            else if (capRate >= 6) score += 10;
            if (cashOnCash >= 8) score += 15;
            else if (cashOnCash >= 5) score += 8;
            if (dscr >= 1.25) score += 15;
            else if (dscr >= 1.0) score += 8;

            if (score >= 80) {
                recommendation = 'üü¢ EXCELLENT INVESTMENT - Strong cash flow and returns!';
                className = 'excellent';
            } else if (score >= 60) {
                recommendation = 'üü° GOOD INVESTMENT - Solid fundamentals with potential';
                className = 'good';
            } else if (score >= 40) {
                recommendation = 'üü† FAIR INVESTMENT - Consider negotiating price or terms';
                className = 'fair';
            } else {
                recommendation = 'üî¥ POOR INVESTMENT - High risk, consider passing';
                className = 'poor';
            }

            const decisionBox = document.getElementById('decisionBox');
            decisionBox.textContent = recommendation + ` (Score: ${score}/100)`;
            decisionBox.className = 'decision-box ' + className;

            // Show export section
            if (purchasePrice > 0 && monthlyRent > 0) {
                document.getElementById('exportSection').style.display = 'block';
            }
        }

        // Export and Save Functions
        function getCurrentAnalysisData() {
            const address = document.getElementById('address').value || 'Property Analysis';
            return {
                timestamp: new Date().toISOString(),
                property: {
                    address: address,
                    propertyType: document.getElementById('propertyType').value,
                    yearBuilt: document.getElementById('yearBuilt').value,
                    sqft: document.getElementById('sqft').value,
                    bedrooms: document.getElementById('bedrooms').value,
                    bathrooms: document.getElementById('bathrooms').value
                },
                financial: {
                    purchasePrice: document.getElementById('purchasePrice').value,
                    downPaymentPercent: document.getElementById('downPaymentPercent').value,
                    downPaymentAmount: document.getElementById('downPaymentAmount').value,
                    interestRate: document.getElementById('interestRate').value,
                    loanTerm: document.getElementById('loanTerm').value,
                    loanAmount: document.getElementById('loanAmount').value,
                    closingCosts: document.getElementById('closingCosts').value,
                    initialRepairs: document.getElementById('initialRepairs').value,
                    totalInvestment: document.getElementById('totalInvestment').value
                },
                income: {
                    monthlyRent: document.getElementById('monthlyRent').value,
                    otherIncome: document.getElementById('otherIncome').value,
                    totalIncome: document.getElementById('totalIncome').value
                },
                expenses: {
                    mortgagePayment: document.getElementById('mortgagePayment').value,
                    propertyTaxes: document.getElementById('propertyTaxes').value,
                    insurance: document.getElementById('insurance').value,
                    hoaFees: document.getElementById('hoaFees').value,
                    mgmtPercent: document.getElementById('mgmtPercent').value,
                    mgmtFee: document.getElementById('mgmtFee').value,
                    maintenancePercent: document.getElementById('maintenancePercent').value,
                    maintenance: document.getElementById('maintenance').value,
                    vacancyPercent: document.getElementById('vacancyPercent').value,
                    vacancy: document.getElementById('vacancy').value,
                    otherExpenses: document.getElementById('otherExpenses').value,
                    totalExpenses: document.getElementById('totalExpenses').value
                },
                results: {
                    cashFlow: document.getElementById('cashFlow').value,
                    onePercentRule: document.getElementById('onePercentRule').textContent,
                    capRate: document.getElementById('capRate').textContent,
                    cashOnCash: document.getElementById('cashOnCash').textContent,
                    dscr: document.getElementById('dscr').textContent,
                    recommendation: document.getElementById('decisionBox').textContent
                }
            };
        }

        function exportToPDF() {
            const data = getCurrentAnalysisData();
            const printContent = generatePrintableReport(data);
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Property Investment Analysis - ${data.property.address}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .section { margin-bottom: 25px; }
                        .section h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
                        .row { display: flex; justify-content: space-between; margin-bottom: 10px; }
                        .label { font-weight: bold; }
                        .value { color: #666; }
                        .results { background: #f8f9fa; padding: 15px; border-radius: 8px; }
                        .recommendation { background: #e8f5e8; padding: 15px; border-radius: 8px; margin-top: 20px; font-weight: bold; text-align: center; }
                        @media print { .no-print { display: none; } }
                    </style>
                </head>
                <body>
                    ${printContent}
                    <div class="no-print" style="text-align: center; margin-top: 30px;">
                        <button onclick="window.print()" style="background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">Print to PDF</button>
                        <button onclick="window.close()" style="background: #95a5a6; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">Close</button>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        function exportToJSON() {
            const data = getCurrentAnalysisData();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `property-analysis-${data.property.address.replace(/[^a-zA-Z0-9]/g, '-')}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function printAnalysis() {
            window.print();
        }

        function saveToLocalStorage() {
            const data = getCurrentAnalysisData();
            const saved = JSON.parse(localStorage.getItem('savedPropertyAnalyses') || '[]');
            saved.push(data);
            localStorage.setItem('savedPropertyAnalyses', JSON.stringify(saved));
            alert('Analysis saved locally!');
            loadSavedAnalyses();
        }

        function loadSavedAnalyses() {
            const saved = JSON.parse(localStorage.getItem('savedPropertyAnalyses') || '[]');
            if (saved.length > 0) {
                document.getElementById('savedAnalyses').style.display = 'block';
                const savedList = document.getElementById('savedList');
                savedList.innerHTML = saved.map((analysis, index) => `
                    <div class="saved-analysis">
                        <h4>${analysis.property.address}</h4>
                        <div class="saved-analysis-meta">
                            Saved: ${new Date(analysis.timestamp).toLocaleDateString()} |
                            Price: $${parseFloat(analysis.financial.purchasePrice || 0).toLocaleString()} |
                            Cash Flow: $${parseFloat(analysis.results.cashFlow || 0).toLocaleString()}/month
                        </div>
                        <div class="saved-analysis-actions">
                            <button onclick="loadAnalysis(${index})" class="load-btn">Load</button>
                            <button onclick="deleteAnalysis(${index})" class="delete-btn">Delete</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function loadAnalysis(index) {
            const saved = JSON.parse(localStorage.getItem('savedPropertyAnalyses') || '[]');
            const analysis = saved[index];
            if (analysis) {
                // Load property data
                document.getElementById('address').value = analysis.property.address || '';
                document.getElementById('propertyType').value = analysis.property.propertyType || '';
                document.getElementById('yearBuilt').value = analysis.property.yearBuilt || '';
                document.getElementById('sqft').value = analysis.property.sqft || '';
                document.getElementById('bedrooms').value = analysis.property.bedrooms || '';
                document.getElementById('bathrooms').value = analysis.property.bathrooms || '';

                // Load financial data
                document.getElementById('purchasePrice').value = analysis.financial.purchasePrice || '';
                document.getElementById('downPaymentPercent').value = analysis.financial.downPaymentPercent || '';
                document.getElementById('interestRate').value = analysis.financial.interestRate || '';
                document.getElementById('loanTerm').value = analysis.financial.loanTerm || '';
                document.getElementById('closingCosts').value = analysis.financial.closingCosts || '';
                document.getElementById('initialRepairs').value = analysis.financial.initialRepairs || '';

                // Load income/expense data
                document.getElementById('monthlyRent').value = analysis.income.monthlyRent || '';
                document.getElementById('otherIncome').value = analysis.income.otherIncome || '';
                document.getElementById('propertyTaxes').value = analysis.expenses.propertyTaxes || '';
                document.getElementById('insurance').value = analysis.expenses.insurance || '';
                document.getElementById('hoaFees').value = analysis.expenses.hoaFees || '';
                document.getElementById('mgmtPercent').value = analysis.expenses.mgmtPercent || '';
                document.getElementById('maintenancePercent').value = analysis.expenses.maintenancePercent || '';
                document.getElementById('vacancyPercent').value = analysis.expenses.vacancyPercent || '';
                document.getElementById('otherExpenses').value = analysis.expenses.otherExpenses || '';

                calculateAll();
                alert('Analysis loaded successfully!');
            }
        }

        function deleteAnalysis(index) {
            if (confirm('Are you sure you want to delete this analysis?')) {
                const saved = JSON.parse(localStorage.getItem('savedPropertyAnalyses') || '[]');
                saved.splice(index, 1);
                localStorage.setItem('savedPropertyAnalyses', JSON.stringify(saved));
                loadSavedAnalyses();
                if (saved.length === 0) {
                    document.getElementById('savedAnalyses').style.display = 'none';
                }
            }
        }

        function generatePrintableReport(data) {
            return `
                <div class="header">
                    <h1>üè† Property Investment Analysis</h1>
                    <h2>${data.property.address}</h2>
                    <p>Generated on ${new Date(data.timestamp).toLocaleString()}</p>
                </div>

                <div class="section">
                    <h2>Property Details</h2>
                    <div class="row"><span class="label">Address:</span><span class="value">${data.property.address}</span></div>
                    <div class="row"><span class="label">Type:</span><span class="value">${data.property.propertyType}</span></div>
                    <div class="row"><span class="label">Year Built:</span><span class="value">${data.property.yearBuilt}</span></div>
                    <div class="row"><span class="label">Square Footage:</span><span class="value">${data.property.sqft}</span></div>
                    <div class="row"><span class="label">Bedrooms:</span><span class="value">${data.property.bedrooms}</span></div>
                    <div class="row"><span class="label">Bathrooms:</span><span class="value">${data.property.bathrooms}</span></div>
                </div>

                <div class="section">
                    <h2>Financial Summary</h2>
                    <div class="row"><span class="label">Purchase Price:</span><span class="value">$${parseFloat(data.financial.purchasePrice || 0).toLocaleString()}</span></div>
                    <div class="row"><span class="label">Down Payment:</span><span class="value">$${parseFloat(data.financial.downPaymentAmount || 0).toLocaleString()} (${data.financial.downPaymentPercent}%)</span></div>
                    <div class="row"><span class="label">Loan Amount:</span><span class="value">$${parseFloat(data.financial.loanAmount || 0).toLocaleString()}</span></div>
                    <div class="row"><span class="label">Interest Rate:</span><span class="value">${data.financial.interestRate}%</span></div>
                    <div class="row"><span class="label">Total Investment:</span><span class="value">$${parseFloat(data.financial.totalInvestment || 0).toLocaleString()}</span></div>
                </div>

                <div class="section">
                    <h2>Cash Flow Analysis</h2>
                    <div class="row"><span class="label">Monthly Rent:</span><span class="value">$${parseFloat(data.income.monthlyRent || 0).toLocaleString()}</span></div>
                    <div class="row"><span class="label">Total Monthly Income:</span><span class="value">$${parseFloat(data.income.totalIncome || 0).toLocaleString()}</span></div>
                    <div class="row"><span class="label">Total Monthly Expenses:</span><span class="value">$${parseFloat(data.expenses.totalExpenses || 0).toLocaleString()}</span></div>
                    <div class="row"><span class="label">Net Monthly Cash Flow:</span><span class="value">$${parseFloat(data.results.cashFlow || 0).toLocaleString()}</span></div>
                </div>

                <div class="section results">
                    <h2>Investment Metrics</h2>
                    <div class="row"><span class="label">1% Rule:</span><span class="value">${data.results.onePercentRule}</span></div>
                    <div class="row"><span class="label">Cap Rate:</span><span class="value">${data.results.capRate}</span></div>
                    <div class="row"><span class="label">Cash-on-Cash Return:</span><span class="value">${data.results.cashOnCash}</span></div>
                    <div class="row"><span class="label">Debt Service Coverage:</span><span class="value">${data.results.dscr}</span></div>
                </div>

                <div class="recommendation">
                    ${data.results.recommendation}
                </div>
            `;
        }

        // Initialize on page load
        window.onload = function() {
            calculateAll();
            loadSavedAnalyses();
        };
    </script>
</body>
</html>